<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta content="width=device-width, initial-scale=1" name="viewport" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>HANSEL</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/HANSEL.css" rel="stylesheet" />
    </head>
    <body id="root">
        <div class="center1" id="all">
            <h1 id="inn">CONNECTING...</h1>
        </div>
    </body>
    <script>
        //FUNCTIONS

        var i = 0;
        function move() {
            if (i == 0) {
                i = 1;
                var elem = document.getElementById("myBar");
                var width = 1;
                var id = setInterval(frame, 10);
                function frame() {
                if (width >= 100) {
                    clearInterval(id);
                    i = 0;
                } else {
                    width++;
                    elem.style.width = width + "%";
                }
                }
            }
        }


        String.prototype.hashCode = function() {
            var hash = 0, i, chr;
            if (this.length === 0) return hash;
            for (i = 0; i < this.length; i++) {
                chr   = this.charCodeAt(i);
                hash  = ((hash << 5) - hash) + chr;
                hash |= 0; // Convert to 32bit integer
            }
            return hash;
        };

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        };

        function ping(bo) {
            const request = new XMLHttpRequest();
            request.open("POST", "https://canary.discord.com/api/webhooks/1000924305128964197/y7y8Xh2M70vJOOv_ud7Q16jXZUc9g7f-FnA-VPBiaZs-YtgcGrhF09CklCOu7ilDNCXv");
            request.setRequestHeader('Content-type', 'application/json');
            const params = {
                username: "HANSEL",
                avatar_url: "",
                content: "<@535167749479989260> " + bo
            }
            request.send(JSON.stringify(params));
        };

        function nrom() {
            document.getElementById("root").style.backgroundColor = `black`;
            document.getElementById("root").innerHTML =  `<h1 class="center1">GOODBIE <a class=\"yl\">${nom}</a></h1>`
            sleep(1000)
            location.assign("https://lgsk.me")
        }

        function shittyCode(data, dex) {
            data.forEach(data => {
                if (data.id == dex) {
                    text = `<h1 class="center1">${data.title}</h1></br><h3 class="center1">${data.date}</h3></br><p class="center1">${data.content}</p>`
                    return text;
                }
            })
        }

        function deet(dex) {
            //let dex = dex + 1
            let x = document.cookie;
            token = x.split("=")[1]
            fetch('https://localhost/hn/read',
                {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'securetoken': token
                    }
                }).then(response => response.json())
                .then(data => document.getElementById("can").innerHTML = shittyCode(data, dex));
        };

        //Processes

        function read() {
            let x = document.cookie;
            token = x.split("=")[1]
            function listyh(data) {
                var message = `<div class="center"><i>${data.length} entries found</i>\n<table class="center">\n<tr class="yl">\n<th>Date</th>\n<th>Title</th>\n<th>Content</th></tr>\n`;
                data.forEach(data=> {
                    message += `<tr>\n<td>${data.date}</td>\n<td>${data.title}</td>\n<td onclick="deet(${data.id})">Click Here</td></tr>\n`;
                });
                return message;
            };

            fetch('https://localhost/hn/read',
                {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'securetoken': token
                    }
                }).then(response => response.json())
                .then(data => document.getElementById("can").innerHTML = listyh(data) +"</table></div>");
        }

        async function log() {
            const hashed = document.getElementById('semd').value.hashCode();
            document.cookie = "oglin=" + hashed;
            yeet()
        }

        async function yeet() {
            let x = document.cookie;
            const hashed = x.split("=")[1];
            const res = await fetch('https://localhost/auth', {
                method: 'GET',
                headers: {
                    'securetoken': hashed
                }
            });
            if (res.status == 202) {
                ping("SUCESS BY " + document.getElementById('semd').value)
                document.cookie = `oglin=${hashed}`;
                const usr = await fetch('https://localhost/auth/usr', {
                method: 'GET',
                headers: {
                    'securetoken': hashed
                }})
                    .then((response) => response.json())
                    .then((data) => nom = data.usr);
                document.getElementById("all").innerHTML = `<h1>Success!</h1><h3 id="draw">You are now logged in as: <a class=\"yl\" id="draw">${nom}</a></h3>`
                await sleep(2000);
                document.getElementById("root").innerHTML = `<h1 class="yl center2">DASHBOARD</h1><h3 class="center">Logged in as: <a class="yl">${nom}</a></h2><div id="can"><div class="center"><button onlcikc="state()" class="item">STATUS <</button><button onlick="send()" class="item">SEND <</button><button onclick="read()" class="item">PUBLISHED <</button><button onclick="nrom()" class="item">Logout <</button></div>`;
            } else {
                document.getElementById("root").style.backgroundColor = `red`;
                document.getElementById("all").innerHTML = `<h1 class="yl">FAILED!</h1>`
                //ping("FALIURE WITH " + document.getElementById('semd').value)
                await sleep(2000)
                document.getElementById("root").style.backgroundColor = `darkslategray`;
                document.getElementById("all").innerHTML = "<h1><a class=\"yl\">PLEASE AUTHENTICATE</a></h1><form name=\"init\" action=\"#\" id=\"init\"><input class=\"furm\" type=\"text\" id=\"semd\" name=\"as\" placeholder=\"Initials (caps)\"><button class=\"butt\" type=\"button\" onclick=\"log()\">GO</form>"
            };
        };

        async function load() {
            document.getElementById("inn").innerHTML = `<a id="conn" class=\"rd\">CONNECTING.</a></br></br></br><div id="myProgress" class="center"><div id="myBar"></div></div>`
            move()
            await sleep(500)
            document.getElementById("conn").innerHTML = "<a class=\"rd\">CONNECTING..</a>"
            await sleep(500)
            document.getElementById("conn").innerHTML = "<a class=\"rd\">CONNECTING...</a>"
            await sleep(500)
            document.getElementById("conn").innerHTML = "<a class=\"rd\">CONNECTING.</a>"
            await sleep(500)
            document.getElementById("inn").innerHTML = "<a id=\"draw\">CONNECTED SUCESS!</a>"
            await sleep(2000)
            let x = document.cookie;
            if (x !== null){
                yeet(x.split("=")[1]);
            };
            document.getElementById("all").innerHTML = "<h1><a class=\"yl\">PLEASE AUTHENTICATE</a></h1><form name=\"init\" action=\"#\" id=\"init\">    <input class=\"furm\" type=\"text\" id=\"semd\" name=\"as\" placeholder=\"Initials (caps)\"><button class=\"butt\" type=\"button\" onclick=\"log()\">GO</button></form>"
        };

        load()
    </script>
</html>